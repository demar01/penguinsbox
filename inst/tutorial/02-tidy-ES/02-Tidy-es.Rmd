---
title: "Datos ordenados: pivotar a lo largo y pivotar a lo ancho"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
description: >
  Reconozca si sus datos están ordenados y ordénelos si es necesario.
---

<!-- Add JavaScript code for making the exercise code larger -->
<script language="JavaScript" src="js/exercise-font-size.js"></script>

```{r setup, include=FALSE}
# load packages-----------------------------------------------------------------

library(learnr)
library(tidyverse)
library(datos)

# set options for exercises and checking ---------------------------------------

nuevos_pinguinos<- tibble(
     anio = c(2020, 2019, 2019, 2020),
     alto_pico_mm  = c(15,15,20,20),
     largo_pico_mm = c(39.1, 42, 39.5, 37.4))

mas_pinguinos<- tibble(
     especie  = c( "Adelia",    "Adelie",     "Adelie",    "Adelie"),
     isla  = c( "Biscoe",    "Dream",     "Dream",    "Torgersen"),
     sexo= c("male",NA,NA,"female"),
     medida = c( "alto_pico_mm",    "alto_pico_mm",     "largo_aleta_mm",    "masa_corporal_g"),
     observations=c(39.1,27,180,3750))

# hide non-exercise code chunks ------------------------------------------------
tutorial_options(exercise.timelimit = 60)
knitr::opts_chunk$set(echo = FALSE)
```

## Introducción

```{r imagen-peng, fig.margin = TRUE, echo = FALSE, out.width = "100%", fig.cap="Imagen de Allison Horst"}
knitr::include_graphics("https://raw.githubusercontent.com/allisonhorst/palmerpenguins/master/man/figures/lter_penguins.png")
```


### Objetivos de aprendizaje

El objetivo de este tutorial es mostrar cómo reconocer datos desordenados, así como manejar datos desordenados para obtener datos ordenados utilizando las funciones `pivot_longer` y `pivot_wider` de tidyr.

### Datos ordenados 

Existen tres reglas interrelacionadas que hacen que un conjunto de datos sea ordenado:

- Cada variable debe tener su propia columna.
- Cada observación debe tener su propia fila.
- Cada valor debe tener su propia celda.

```{r datos-ordenados, fig.margin = TRUE, echo = FALSE, out.width = "100%", fig.cap="Figura 12.1 del libro R para ciencia de datos"}
knitr::include_graphics("https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/tidy-1.svg")
```

```{r echo = TRUE}
nuevos_pinguinos
```

### Test 1 - ¿Cuáles son las variables?

```{r test1, echo = FALSE}
question("¿Cuáles son las variables en el conjunto de datos anterior? Marque todo lo que corresponda.",
         answer("anio", correct = TRUE),
         answer("alto_pico_mm", correct = TRUE),
         answer("largo_pico_mm", correct = TRUE),
         answer("int"),
         answer("dbl"),
         allow_retry = TRUE, 
         correct = "Muy bien! Estos datos nuevos contienen cuatro observaciones medidas con tres variables: anio,isla, largo_pico_mm."
)
```
### Test 2 - ¿Están los datos ordenados?

Considere estos nuevos datos de pinguinos:

```{r echo = TRUE}
mas_pinguinos
```

```{r test2, echo = FALSE}
question("Does the data above contain the variables **country**, **year**, **cases**, and **population**?",
         answer("No", correct = TRUE, message = "If you look closely, you will see that this is the same data set as before, but organized in a new way."),
         answer("Si", message = "Don't be mislead by the two new column names: a variable and a column name are not necessarily the same thing."),
         allow_retry = TRUE
)
```

## Pivotar

Recordemos los nuevos pinguinos
```{r echo = TRUE}
nuevos_pinguinos
```

Podemos pivotar a lo ancho y a lo largo consecutivamente para volver a tener datos ordenados.
```{r echo = TRUE}
nuevos_pinguinos %>%
  pivot_wider(names_from = anio, values_from = largo_pico_mm) %>%
  pivot_longer(`2019`:`2020`, names_to = "anio", values_to = "largo_pico_mm",
               names_transform = list(anio = as.numeric))
```
Si desgranamos el ejercicio vemos que pivot_wider toma... y los pone .... 
Estos datos no están ordenados porque...
```{r}
nuevos_pinguinos %>%
  pivot_wider(names_from = anio, values_from = largo_pico_mm) 
```

Pivot_longer coloca ..



```{r}
nuevos_pinguinos %>%
  pivot_wider(names_from = anio, values_from = largo_pico_mm) %>%
  pivot_longer(`2019`:`2020`, names_to = "anio", values_to = "largo_pico_mm",
               names_transform = list(anio = as.numeric))
```

## En resumen

Será más fácil trabajar con datos ordenados en R. Puede ordenarlos al comienzo de su análisis. Los datos están ordenados si:

- Cada variable debe tener su propia columna.
- Cada observación debe tener su propia fila.
- Cada valor debe tener su propia celda.

Puede usar pivot_wider() y pivot_longer(). 
You can use gather() and spread(), o alguna secuencia iterativa de los dos, para remodelar sus datos de manera que:

- Se conserven todos los valores de su conjunto de datos original
- Se retengan todas las relaciones entre valores en su conjunto de datos original.


